<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Using a agentic workflow to set up complex simulation models"><title>JutulGPT - Agent-based reservoir simulation with JutulDarcy.jl</title><link rel=canonical href=https://moyner.github.io/p/agentic-simulation/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="JutulGPT - Agent-based reservoir simulation with JutulDarcy.jl"><meta property='og:description' content="Using a agentic workflow to set up complex simulation models"><meta property='og:url' content='https://moyner.github.io/p/agentic-simulation/'><meta property='og:site_name' content='Olav Møyner'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2025-09-08T00:00:00+00:00'><meta property='article:modified_time' content='2025-09-08T00:00:00+00:00'><meta property='og:image' content='https://moyner.github.io/p/agentic-simulation/agent.png'><meta name=twitter:title content="JutulGPT - Agent-based reservoir simulation with JutulDarcy.jl"><meta name=twitter:description content="Using a agentic workflow to set up complex simulation models"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://moyner.github.io/p/agentic-simulation/agent.png'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_108111f6278aa707.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Olav Møyner</a></h1><h2 class=site-description>Professional website of Olav Møyner.</h2></div></header><ol class=menu-social><li><a href=https://www.sintef.no/en/all-employees/employee/olav.moyner/ target=_blank title=@SINTEF rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-briefcase-2"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 9a2 2 0 012-2h14a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/><path d="M8 7V5a2 2 0 012-2h4a2 2 0 012 2v2"/></svg></a></li><li><a href=https://github.com/moyner target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href='https://scholar.google.com/citations?user=ivMvG4wAAAAJ' target=_blank title="Google Scholar" rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-google"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M20.945 11a9 9 0 11-3.284-5.997l-2.655 2.392A5.5 5.5.0 1017.125 14H13v-3h7.945z"/></svg></a></li><li><a href=https://www.linkedin.com/in/moyner/ target=_blank title=LinkedIn rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-linkedin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 10-4 0"/><path d="M3 7a4 4 0 014-4h10a4 4 0 014 4v10a4 4 0 01-4 4H7a4 4 0 01-4-4z"/></svg></a></li><li><a href=https://orcid.org/0000-0001-9993-3879 target=_blank title=ORCID rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-link"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 15l6-6"/><path d="M11 6l.463-.536a5 5 0 017.071 7.072L18 13"/><path d="M13 18l-.397.534a5.068 5.068.0 01-7.127.0 4.972 4.972.0 010-7.071L6 11"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/cv/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>CV</span></a></li><li><a href=/software/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-device-desktop"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 5a1 1 0 011-1h16a1 1 0 011 1v10a1 1 0 01-1 1H4a1 1 0 01-1-1V5z"/><path d="M7 20h10"/><path d="M9 16v4"/><path d="M15 16v4"/></svg>
<span>Software</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/publications/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-books"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 4m0 1a1 1 0 011-1h2a1 1 0 011 1v14a1 1 0 01-1 1H6a1 1 0 01-1-1z"/><path d="M9 4m0 1a1 1 0 011-1h2a1 1 0 011 1v14a1 1 0 01-1 1h-2a1 1 0 01-1-1z"/><path d="M5 8h4"/><path d="M9 16h4"/><path d="M13.803 4.56l2.184-.53c.562-.135 1.133.19 1.282.732l3.695 13.418a1.02 1.02.0 01-.634 1.219l-.133.041-2.184.53c-.562.135-1.133-.19-1.282-.732L13.036 5.82a1.02 1.02.0 01.634-1.219l.133-.041z"/><path d="M14 9l4-1"/><path d="M16 16l3.923-.98"/></svg>
<span>Publications</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#motivation>Motivation</a></li><li><a href=#building-an-agent-for-reservoir-simulation>Building an agent for reservoir simulation</a><ol><li><a href=#picking-a-code>Picking a code</a></li><li><a href=#software-stack>Software stack</a></li><li><a href=#tools>Tools</a><ol><li><a href=#retrieval-tools>Retrieval tools</a></li><li><a href=#code-execution-tools>Code execution tools</a></li></ol></li><li><a href=#human-in-the-loop>Human-in-the-loop</a></li></ol></li><li><a href=#experiences>Experiences</a><ol><li><a href=#general>General</a></li><li><a href=#documentation-and-errors-what-does-the-agent-use>Documentation and errors: What does the agent use?</a></li><li><a href=#surprise-1-the-negative-well-radius>Surprise 1: The negative well radius</a></li><li><a href=#surprise-2-mpi-programming-for-agents>Surprise 2: MPI-programming for agents</a></li></ol></li><li><a href=#recommendations--conclusions>Recommendations & conclusions</a><ol><li><a href=#links-to-source-code-and-other-material>Links to source code and other material</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/agentic-simulation/><img src=/p/agentic-simulation/agent_hu_8132094ded1024c6.png srcset="/p/agentic-simulation/agent_hu_8132094ded1024c6.png 800w, /p/agentic-simulation/agent_hu_bb029e4f51f8dfbf.png 1600w" width=800 height=288 loading=lazy alt="Featured image of post JutulGPT - Agent-based reservoir simulation with JutulDarcy.jl"></a></div><div class=article-details><header class=article-category><a href=/categories/julia/ style=background-color:#2a3d8f;color:#fff>Julia
</a><a href=/categories/jutuldarcy/ style=background-color:#2a932f;color:#fff>JutulDarcy</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/agentic-simulation/>JutulGPT - Agent-based reservoir simulation with JutulDarcy.jl</a></h2><h3 class=article-subtitle>Using a agentic workflow to set up complex simulation models</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Sep 08, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>11 minute read</time></div></footer></div></header><section class=article-content><h2 id=motivation>Motivation</h2><p><em>This blog post is based on work together with Elling Svee (who did most of the coding!), Knut-Andreas Lie, Kjetil Lye Olsen and Jakob Torben. <a class=link href=https://github.com/ellingsvee/JutulGPT target=_blank rel=noopener>code is available on GitHub</a>.</em></p><p>There is a fair bit of hype around large language model (LLM) agents at the moment, and discussions about what they can be used for. LLM-based agents are, in the broadest sense, essentially LLMs that are given a set of tools that can be used to perform tasks. Tools are typically a function call together with metadata (description of usage, purpose, etc) and allows a LLM program to perform tasks by estimating what the appropriate tool should be whenever a text response is insufficient.</p><p><img src=/p/agentic-simulation/agent.png width=1108 height=399 srcset="/p/agentic-simulation/agent_hu_c81b5b1c5b4deeee.png 480w, /p/agentic-simulation/agent_hu_34debf50892f60a9.png 1024w" loading=lazy alt="Conceptual flowchart of how a simple agent can chain different tools to produce output - by Elling Svee" class=gallery-image data-flex-grow=277 data-flex-basis=666px></p><p>At the <a class=link href=https://www.sintef.no/en/digital/departments/department-of-mathematics-and-cybernetics/research-group-applied-computational-science/ target=_blank rel=noopener>Applied Computational Science group</a>, we work extensively with numerical simulation of physical processes. We are developing open source software for reservoir simulation (e.g. <a class=link href=https://github.com/SINTEF-AppliedCompSci/MRST target=_blank rel=noopener>MRST</a>, <a class=link href=https://opm-project.org/ target=_blank rel=noopener>OPM Flow</a> and <a class=link href=https://github.com/sintefmath/JutulDarcy.jl target=_blank rel=noopener>JutulDarcy</a>.jl) as well as software for battery simulation and many other applications. In this post, we will limit the discussion to reservoir simulation, but most of the lessions apply to other types of modelling as well.</p><p>We are interested in exploring how agents can be used to set up and interact with complex simulation models, examplified by a reservoir simulator. We can break down a basic reservoir simulation workflow into four steps:</p><ol><li>Define the model itself: Setting up a mesh, populating it with static properties (e.g. permeability/porosity), defining a fluid model and setting up wells, aquifers and other types of boundary conditions.</li><li>Set up a scenario to simulate: Pick operating controls/limits for the wells, time-steps to solve before simulating with the approprioate numerical tolerances, linear solver and solution strategy.</li><li>Perform analysis on the results, for example by computing the total thermal energy produced over a given number of years, examining the amount of CO2 stored in a CCS model, and so on.</li><li>Based on the analysis and goal, go back and redo steps 1-3 to improve the setup by introducing additional features, increasing grid resolution, adding tracers, moving wells, etc.</li></ol><p>Reservoir simulators are complex pieces of software, and iterating between these four steps requires detailed knowledge of:</p><ul><li>Reservoir engineering: <em>What physical process am I modelling?</em></li><li>Reservoir simulation: <em>What is the right choice of physics and resolution to capture the process?</em></li><li>Specific software know-how: <em>How do I make the available software do what I want? What are the limitations? How do I transfer data between applications?</em></li></ul><p>Each topic can be a daunting field of study in itself, so there exists a substantial challenge when it comes to making these modelling workflows accessible, especially for experts who want to test a new code for an existing application. This workflow sketch is also intentionally a bit simplistic, and most experienced reservoir simulation readers will spot some missing details (where are the ensembles? What about seismic interpretation? Where do you get the fluid data? What method do you use for populating the properties?).</p><p>I have personally no expectation that LLMs are going to be replacing &ldquo;PhD level intelligence&rdquo; any time soon - but they seem to have potential as a research partner that can perform time-consuming tasks and condense information from documentation and technical sources very quickly. The goal is not to stop writing code, but to spend the time on the code that really matters. For this reason, we have an internal activity targeted towards use of LLMs with simulators. The goal is to allow a LLM to help with setting up simulations, looking up documentation and performing task-specific coding in steps 1 to 4 above.</p><p>For more information on the high level goals of this activity, have a look at the SINTEF page on <a class=link href=https://www.sintef.no/en/digital/departments/department-of-mathematics-and-cybernetics/research-group-applied-computational-science/discussing-with-your-simulator/ target=_blank rel=noopener>Discussing with your simulator</a>.</p><h2 id=building-an-agent-for-reservoir-simulation>Building an agent for reservoir simulation</h2><p>The best way to get started with technology is to build something, so this year we allocated one of our many talented summer student towards building a prototype agent for reservoir simulation. Up front, we knew that two months were unlikely to build the agents of our dreams, so the scope was initially limited to steps 1/2, i.e. setting up simulation models rather than analysis of the results.</p><h3 id=picking-a-code>Picking a code</h3><p>We also had the issue of <em>what</em> code was to be used. We have three open source reservoir simulators that were candidates:</p><ul><li><a class=link href=https://github.com/SINTEF-AppliedCompSci/MRST target=_blank rel=noopener>MRST</a> is a MATLAB-based toolbox for reservoir simulation and uses scripts to set up models, and has been around for a long time with a large number of different modules</li><li><a class=link href=https://opm-project.org/ target=_blank rel=noopener>OPM Flow</a> is a C++ based reservoir simulator that is run by industry standard input files</li><li><a class=link href=https://github.com/sintefmath/JutulDarcy.jl target=_blank rel=noopener>JutulDarcy.jl</a> is a Julia-based reservoir simulator that also uses scripts as the primary setup</li></ul><p>We considered working directly on the industry standard .DATA files, as all three codes can set up models this way, but these files are both enormously complex, and are limited to the model setup as analysis is usually done in another language or GUI anyway. We selected JutulDarcy.jl for two reasons:</p><ol><li><a class=link href=https://github.com/sintefmath/JutulDarcy.jl target=_blank rel=noopener>JutulDarcy.jl</a> is easy to call from within an agent framework, since Julia is pretty easy to both install and call in a virtual machine.</li><li><a class=link href=https://github.com/SINTEF-AppliedCompSci/MRST target=_blank rel=noopener>MRST</a> has a large number of modules that have been written over the last 15 years, with code styles, interfaces and documentation that varies from module to module. This wide feature set is very valuable to researchers, but the magnitude means that it is less useful to a LLM, which has a limited context window and has a hard time with a non-unified coding style across modules.</li></ol><h3 id=software-stack>Software stack</h3><p>After a bit of testing with smaller tools (like <a class=link href=https://github.com/svilupp/PromptingTools.jl target=_blank rel=noopener>PromptingTools.jl</a>), we ended up using <a class=link href=https://github.com/langchain-ai/langchain target=_blank rel=noopener>LangChain</a> as the framework. We picked LangChain since it seemed to be fairly mature, featured and could easily use locally hosted LLMs.</p><p>The <a class=link href=https://github.com/ellingsvee/JutulGPT target=_blank rel=noopener>code is available on GitHub</a> for those who want to dig into the details.</p><p>Elling has made two interfaces for JutulGPT: A <a class=link href=https://github.com/ellingsvee/JutulGPT-GUI target=_blank rel=noopener>chat-based frontend</a> based on the <a class=link href=https://github.com/langchain-ai/agent-chat-ui target=_blank rel=noopener>LangGraph Agent Chat UI</a> that should be familiar if you have used e.g. ChatGPT, and a dedicated command line interface (CLI). The CLI is recommended if you are familiar with programming.</p><p><img src=/p/agentic-simulation/jutulgpt_cli.png width=3456 height=2159 srcset="/p/agentic-simulation/jutulgpt_cli_hu_d622f11ef5a825eb.png 480w, /p/agentic-simulation/jutulgpt_cli_hu_78a74d39b5d2fd7d.png 1024w" loading=lazy alt="Example of the command line interface (CLI)" class=gallery-image data-flex-grow=160 data-flex-basis=384px> <img src=/p/agentic-simulation/jutulgpt_web.png width=917 height=921 srcset="/p/agentic-simulation/jutulgpt_web_hu_c9fc53c4b15a6367.png 480w, /p/agentic-simulation/jutulgpt_web_hu_cd4595aebb458637.png 1024w" loading=lazy alt="Example of the web/chat-based interface" class=gallery-image data-flex-grow=99 data-flex-basis=238px></p><h3 id=tools>Tools</h3><p>An agent is defined by the available tools. Here is a brief rundown of the most important tools that Elling implemented.</p><h4 id=retrieval-tools>Retrieval tools</h4><ul><li><code>grep_search</code>: Perform a text search in the documentation, returning a list of matches. The agent can then read the files containing the matches.</li><li><code>retrieve_function_documentation</code>: Get the docstring of a function, using the Julia <code>@doc</code> macro.</li><li><code>retrieve_examples</code>: Performs a semantic search to find relevant JutulDarcy examples stored in a
vector database. Full examples are embedded, which helps generate code for complete simulations.</li></ul><h4 id=code-execution-tools>Code execution tools</h4><ul><li><code>run_linter</code>: Run static analysis on generated code, verifying if it is valid Julia code that calls existing functions (but does not guarantee that the code actually runs).</li><li><code>run_julia_code</code>: Run the code and return any error messages.</li><li><code>execute_terminal_command</code>: Exactly what it says on the tin.</li></ul><p>In addition, there are a set of tools for reading/writing to disk and accessing the file system.</p><h3 id=human-in-the-loop>Human-in-the-loop</h3><p>LLMs, especially those that can run locally, often make mistakes. Elling made a choice to include an optional &ldquo;human-in-the-loop&rdquo; feature. I think his report put it quite nicely, so I am just going to quote him directly:</p><blockquote><p>Providing the model with more tools can lead to more complex behavior. This often results in the model acting more autonomously, which can be both an advantage and a challenge. Smaller language models in particular tend to struggle with complex tasks. In my experience, they sometimes choose the wrong tools, get stuck on minor errors, or generate code that does not meet the user’s requirements. One way to address these issues is to include human feedback in the agent’s decision-making process, a method commonly referred to as human-
in-the-loop (HITL). This approach allows users to provide input and corrections, ensuring that
the agent’s actions align with their expertise.</p><p>I have implemented HITL-interactions in the workflow and in many of the available tools. For example, when the agent retrieves information from the JutulDarcy documentation or examples, the user can review and filter the retrieved content. When the agent generates code based on user requirements, it presents the code to the user for review before execution. This gives the user an opportunity to make manual adjustments or suggest improvements.</p></blockquote><h2 id=experiences>Experiences</h2><h3 id=general>General</h3><p>The first exploratory attempts used locally hosted LLM models together with a &ldquo;one-shot&rdquo; approach to generate all the code requested by the user where the entire script would be set up from a single query. This was not very successful, both because the self-hosted models on a normal consumer grade GPU are quite limited, and because generating a full example in a single go does not seem productive. The agent will either retrieve an example unmodified from the examples, or it will hallucinate non-working code.</p><p>In addition, even with GPT4.1, the one-shot approach had a tendency to include code in nonsensical ways. One example is the treatment of units: Realistic reservoir simulation in JutulDarcy.jl means setting up realistic units, and we ship the code with conversion factors for the standard units used in petroleum engineering, which is readily documented by usage in the examples. However, this is a bit underdocumented in the structured documentation. As a consequence, the agent would often insert usage of the <a class=link href=https://github.com/JuliaPhysics/Unitful.jl target=_blank rel=noopener>Unitful.jl</a> library in the code. Unitful is a library for sending <em>typed</em> units through programs and does not contain any of the oil field units, leading to confusing errors.</p><p>The generated code became a lot better when the agent was allowed to iterate on the code before presenting it to the user, and make use of static linting. This removed a lot of the issues with hallucinated code, as the static linting will make it aware of what functions are actually available in the environment. This does burn more tokens, however, but it seems to be necessary to iterate to produce good results.</p><h3 id=documentation-and-errors-what-does-the-agent-use>Documentation and errors: What does the agent use?</h3><p>The experience from MRST and JutulDarcy.jl usage is that typical users go straight for the examples and barely read the main documentation. We therefore focus on having long-form end-to-end example scripts (<a class=link href=https://sintefmath.github.io/JutulDarcy.jl/dev/examples/workflow/fully_differentiable_geothermal target=_blank rel=noopener>example</a>) that can be a starting point for users. It was initially a bit surprising to see that these examples were not so useful for the LLM - the individual docstrings and text-based documentation were much more important to get good results. However, this does make sense, as the smaller parts are more digestable than a long example the LLM has a hard time to break down into chunks. We could perhaps make the examples more digestible by splitting it up. Similarly, writing high-quality error messages is worthwhile, as this is how the agent self-corrects during the write-evaluate loop.</p><h3 id=surprise-1-the-negative-well-radius>Surprise 1: The negative well radius</h3><p>LLMs can often produce a lot of garbage code when given free reign, however, there are moments when they appear to be magic. One such instance happened during testing, when Kjetil had made a standardized prompt for testing different models, asking the model to set up a quarter-five-spot oil-water injection case on the unit square with 10 by 10 cells. This is a typical &ldquo;hello world&rdquo; reservoir simulation, if it were not for the fact that the domain is the unit square. If the mesh has unit length discretized by 10 cells, each cell is 0.1 meters wide, which is very small. In fact, it is smaller than the default diameter of the well in that grid block. This fact leads to a negative Peaceman factor - a standard analytical expression for the connection factor between a large grid block and the well inside it - and an error will occur.</p><p>The surprise? The LLM quickly explains exactly how this occurs and how to fix it by hinting that the size of the domain is not realistic. Somewhere in all the model weights there are some digested parts of classical reservoir simulation texts, and the retrieval into the right context feels like magic (I have a lot of old e-mails from students asking about the negative radius).</p><h3 id=surprise-2-mpi-programming-for-agents>Surprise 2: MPI-programming for agents</h3><p>During user testing, one of my colleagues asked the agent to convert an existing simulation script into a MPI (distributed memory parallel) run. The agent managed to read the documentation, set up an environment with the required packages and modify the script in exactly the right places. It also set up a bash script to launch Julia with the right number of processes, pointing to the correct MPI binary. While this is documented in the <a class=link href=https://sintefmath.github.io/JutulDarcy.jl/dev/man/advanced/mpi target=_blank rel=noopener>JutulDarcy.jl documentation on parallelism</a>, the surgical modification of a user-provided script left me very impressed.</p><h2 id=recommendations--conclusions>Recommendations & conclusions</h2><p>Although they are far from perfect programmers, agents seem to have significant potential for working with complex simulation codes. Here are a few of our (speculative) recommendations if you want to attempt something similar:</p><ul><li>Improve your docstrings and error messages as much as possible, and make these available to the agent. Make error messages for nonsensical inputs as early as possible rather than during the final simulation call (for example: Negative permeability is an error when input - even if it is a valid floating point number).</li><li>Documentation should be smaller digestible chunks for the best results.</li><li>Static analysis of code can save a lot of tokens and frustration</li></ul><p>Even as the project was limited to only two months, we believe the resulting code can be quite useful, both as a novel tool for learning how to use JutulDarcy for reservoir simulation, and how to build an agent workflow for a simulation code. We encourage anyone who is interested to dig through or even run the code. The code is released under a permissive MIT license, just like JutulDarcy.jl itself.</p><h3 id=links-to-source-code-and-other-material>Links to source code and other material</h3><p><a class=link href=https://github.com/ellingsvee/JutulGPT target=_blank rel=noopener>Source</a>
<a class=link href=https://github.com/ellingsvee/JutulGPT/blob/main/src/jutulgpt/prompts.py target=_blank rel=noopener>Prompts</a>
<a class=link href=main.pdf>Additional details are found in Elling&rsquo;s report.</a></p><p>If you do want to run the code: Please note that as the code can in principle execute terminal commands, we recommend that you carefully read the outputs before executing, ideally in some sort of VM.</p></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/phone-simulation/><div class=article-image><img src=/p/phone-simulation/header.965df0fd47781ea773d76607b8f6f922_hu_67ba0d9935083aa2.png width=250 height=150 loading=lazy alt="Featured image of post Running a reservoir simulation on my phone" data-key=phone-simulation data-hash="md5-ll3w/Ud4Hqdz12YHuPb5Ig=="></div><div class=article-details><h2 class=article-title>Running a reservoir simulation on my phone</h2></div></a></article></div></div></aside><div id=cusdis_thread data-host=https://cusdis.com data-app-id=0cf31954-3f6c-4a58-ad15-8f18fafe089c data-page-id=858bc7d45486ccce10610b345e25bc1f data-page-url=https://moyner.github.io/p/agentic-simulation/ data-page-title="JutulGPT - Agent-based reservoir simulation with JutulDarcy.jl"></div><script async defer src=https://cusdis.com/js/cusdis.es.js></script><script>function setCusdisTheme(e){let t=document.querySelector("#cusdis_thread iframe");t&&window.CUSDIS.setTheme(e)}window.addEventListener("onColorSchemeChange",e=>{setCusdisTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 Olav Møyner</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.31.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>